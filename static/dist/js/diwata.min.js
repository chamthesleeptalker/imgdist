function executeFilters(){var a=areaSelect.getBounds(),b=a._southWest,c=a._northEast,d=cloudSlider.noUiSlider.get(),e={satellite:$("#satelliteFilter").val(),sensor:$("#sensorFilter").val(),start:$("#datefilterstart").val(),end:$("#datefilterend").val(),cloudRange:"["+d[0]+","+d[1]+"]",bbox:JSON.stringify([b.lng,b.lat,c.lng,c.lat])};$.get(main_url,e,function(a){updateMapMarkers(a),updateCards(a)})}function updateMapMarkers(a){image_markers&&image_markers.clearLayers(),image_markers.addData(a)}function updateCards(a){var b=$("#card-template").html();Mustache.parse(b),data_array=a.features;var c=[];for(var d in data_array){var e={image_url:img_url+data_array[d].properties.thumbnail_url,sensor:data_array[d].properties.sensor,satellite:data_array[d].properties.satellite,date:data_array[d].properties.acquisition_date,receiving_station:data_array[d].properties.receiving_station,scene_name:data_array[d].properties.scene_name,cloud_cover:data_array[d].properties.cloud_cover};c.push(e)}rendered_cards=Mustache.to_html(b,{cards:c}),$("#imageCards").html(rendered_cards)}function init(){$.material.init(),$("#datefilterstart").datetimepicker({format:"YYYY-MM-DD",defaultDate:"2016-01-01"}),$("#datefilterend").datetimepicker({format:"YYYY-MM-DD",defaultDate:new Date}),noUiSlider.create(cloudSlider,{start:[0,100],connect:!0,margin:5,step:5,range:{min:0,max:100}})}function init_map(){map=L.map("map");var a="http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",b='Map data Â© <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',c=new L.TileLayer(a,{minZoom:2,maxZoom:12,attribution:b});map.setView(new L.LatLng(11.5,121.8),6),map.addLayer(c);var d,e;d=$("#map_section").width(),e=$("#map_section").height(),areaSelect=L.areaSelect({width:d-100,height:e-100}),areaSelect.addTo(map),areaSelect.on("change",function(){bounds=areaSelect.getBounds(),executeFilters(bounds)});var f={radius:8,fillColor:"#1c3166",color:"#000",weight:1,opacity:1,fillOpacity:.4},g={color:"#1C0021",weight:3,opacity:1,fillColor:"#1C0021",fillOpacity:.3},h={closeOnClick:!0,className:"popup",closeButton:!1};image_markers=L.geoJson(!1,{style:function(a){return"Point"==a.geometry.type?f:g},pointToLayer:function(a,b){return L.circleMarker(b,f)},onEachFeature:function(a,b){var c=new L.popup(h),d="<h4>SCENE INFO</h4>";d+="<p><b>Acquisition Date:</b> "+a.properties.acquisition_date+"</p>",d+="<p><b>Cloud Cover:</b> "+a.properties.cloud_cover+"</p>",d+="<p><b>Receiving Station:</b> "+a.properties.receiving_station+"</p>",d+="<p><b>Satellite:</b> "+a.properties.satellite+"</p>",d+="<p><b>Scene Name:</b> "+a.properties.scene_name+"</p>",d+="<p><b>Sensor:</b> "+a.properties.sensor+"</p>",c.setContent(d),b.bindPopup(c)}}),image_markers.addTo(map)}var main_url="http://diwataapi-lkpanganiban.rhcloud.com/api/scene/multi/",img_url="http://diwataapi-lkpanganiban.rhcloud.com/static",cloudSlider=$("#cloudFilter")[0];$(function(){init(),init_map(),$("#satelliteFilter, #sensorFilter").on("change",function(){executeFilters()}),$("#datefilterstart, #datefilterend").on("dp.change",function(){executeFilters()}),cloudSlider.noUiSlider.on("update",function(){executeFilters()}),executeFilters()});