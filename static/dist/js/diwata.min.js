function executeFilters(){var a=areaSelect.getBounds(),b=a._southWest,c=a._northEast,d=cloudSlider;void 0==cloudSlider.data().from?$("#currentCloudFil").html("0 - 100%"):$("#currentCloudFil").html(d.data().from+" - "+d.data().to+"%");var e={satellite:$("#satelliteFilter").val(),sensor:$("#sensorFilter").val(),start:$("#datefilterstart").val(),end:$("#datefilterend").val(),cloudRange:"["+d.data().from+","+d.data().to+"]",bbox:JSON.stringify([b.lng,b.lat,c.lng,c.lat]),zoomtoscene:""};$.get(main_url,e,function(a){updateMapMarkers(a),updateCards(a),updateOnImageCartCards(imageCartEntries)})}function updateMapMarkers(a){image_markers&&image_markers.clearLayers(),image_markers.addData(a)}function zoomToScene(a){if(a.length<2){var b=L.polygon(a[0]),c=[b.getBounds().getCenter().lng,b.getBounds().getCenter().lat];map.setView(c,8)}else{var d=L.circleMarker([a[1],a[0]]),e=[d.getLatLng().lat,d.getLatLng().lng];map.setView(e,8)}}function addImageToCart(a,b){var c={scene_name:a,image_url:b};imageCartEntries.push(c);var d=imageCartEntries.length;$("#imageCartCount").text(d),$("#imagetocart_"+a).text("Remove from Cart"),$("#imagetocart_"+a).removeClass("btn-info"),$("#imagetocart_"+a).addClass("btn-warning"),$("#imagetocart_"+a).attr("onclick",'removeImageFromCart("'+a+'","'+b+'")');var e=$("#imagecart-template").html();Mustache.parse(e),rendered_imageCartEntries=Mustache.to_html(e,{imageCartEntries:imageCartEntries}),$("#imageCartList").html(rendered_imageCartEntries)}function removeImageFromCart(a,b){var c={scene_name:a,image_url:b};removedCartEntries.push(c);var d=_.findIndex(imageCartEntries,c),e=(_.pullAt(imageCartEntries,d),imageCartEntries.length);$("#imageCartCount").text(e),$("#imagetocart_"+a).text("Add to Cart"),$("#imagetocart_"+a).removeClass("btn-warning"),$("#imagetocart_"+a).addClass("btn-info"),$("#imagetocart_"+a).attr("onclick",'addImageToCart("'+a+'","'+b+'")');var f=$("#imagecart-template").html();Mustache.parse(f),rendered_imageCartEntries=Mustache.to_html(f,{imageCartEntries:imageCartEntries}),$("#imageCartList").html(rendered_imageCartEntries)}function updateCards(a){var b=$("#card-template").html();Mustache.parse(b),data_array=a.features;var c=[];for(var d in data_array){var e={image_url:img_url+data_array[d].properties.thumbnail_url,sensor:data_array[d].properties.sensor,satellite:data_array[d].properties.satellite,date:data_array[d].properties.acquisition_date,receiving_station:data_array[d].properties.receiving_station,scene_name:data_array[d].properties.scene_name,cloud_cover:data_array[d].properties.cloud_cover,zoomtoscene:JSON.stringify(data_array[d].geometry.coordinates)};c.push(e)}rendered_cards=Mustache.to_html(b,{cards:c}),$("#imageCards").html(rendered_cards)}function updateOnImageCartCards(a){for(var b in a)onClickRemoveFromCart(a[b])}function onClickRemoveFromCart(a){$("#imagetocart_"+a.scene_name).text("Remove from Cart"),$("#imagetocart_"+a.scene_name).removeClass("btn-info"),$("#imagetocart_"+a.scene_name).addClass("btn-warning"),$("#imagetocart_"+a.scene_name).attr("onclick",'removeImageFromCart("'+a.scene_name+'","'+a.image_url+'")')}function init(){$.material.init(),$("#datefilterstart").datetimepicker({format:"YYYY-MM-DD",defaultDate:"2016-01-01"}),$("#datefilterend").datetimepicker({format:"YYYY-MM-DD",defaultDate:new Date}),cloudSlider.ionRangeSlider({type:"double",min:0,max:100,from:0,to:100,grid:!0})}function init_map(){var a="http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",b='Map data Â© <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',c=new L.TileLayer(a,{minZoom:2,maxZoom:12,attribution:b});map.setView(new L.LatLng(11.5,121.8),6),map.addLayer(c);var d,e;d=$("#map_section").width(),e=$("#map_section").height(),areaSelect=L.areaSelect({width:d-100,height:e-100,keepAspectRatio:!1}),areaSelect.addTo(map),areaSelect.on("change",function(){bounds=areaSelect.getBounds(),executeFilters(bounds)});var f={radius:8,fillColor:"#1c3166",color:"#000",weight:1,opacity:1,fillOpacity:.4},g={color:"#1C0021",weight:3,opacity:1,fillColor:"#1C0021",fillOpacity:.3},h={closeOnClick:!0,className:"popup",closeButton:!1};image_markers=L.geoJson(!1,{style:function(a){return"Point"==a.geometry.type?f:g},pointToLayer:function(a,b){return L.circleMarker(b,f)},onEachFeature:function(a,b){var c=new L.popup(h),d="<h4>SCENE INFO</h4>";d+="<p><b>Acquisition Date:</b> "+a.properties.acquisition_date+"</p>",d+="<p><b>Cloud Cover:</b> "+a.properties.cloud_cover+"</p>",d+="<p><b>Receiving Station:</b> "+a.properties.receiving_station+"</p>",d+="<p><b>Satellite:</b> "+a.properties.satellite+"</p>",d+="<p><b>Scene Name:</b> "+a.properties.scene_name+"</p>",d+="<p><b>Sensor:</b> "+a.properties.sensor+"</p>",c.setContent(d),b.bindPopup(c)}}),image_markers.addTo(map)}var imageCartEntries=[],removedCartEntries=[],main_url="http://diwataapi-lkpanganiban.rhcloud.com/api/scene/multi/",img_url="http://diwataapi-lkpanganiban.rhcloud.com/static",cloudSlider=$("#cloud_slide"),map=L.map("map");$(function(){init(),init_map(),$("#satelliteFilter, #sensorFilter").on("change",function(){executeFilters()}),$("#datefilterstart, #datefilterend").on("dp.change",function(){executeFilters()}),cloudSlider.on("change",function(){executeFilters()}),executeFilters()}),$("#cloud_fil").on("click",function(){$("#cloudFilterContainer").slideToggle("fast")});