function executeFilters(){var a=areaSelect.getBounds(),b=a._southWest,c=a._northEast,d={satellite:$("#satelliteFilter").val(),sensor:$("#sensorFilter").val(),start:$("#datefilterstart").val(),end:$("#datefilterend").val(),cloudRange:"[0,100]",bbox:JSON.stringify([b.lng,b.lat,c.lng,c.lat])};$.get(main_url,d,function(a){updateMapMarkers(a),updateCards(a)})}function updateMapMarkers(a){image_markers&&image_markers.clearLayers(),image_markers.addData(a)}function updateCards(a){var b=$("#card-template").html();Mustache.parse(b),data_array=a.features;var c=[];for(var d in data_array){var e={image_url:img_url+data_array[d].properties.thumbnail_url,sensor:data_array[d].properties.sensor,satellite:data_array[d].properties.satellite,date:data_array[d].properties.acquisition_date};c.push(e)}rendered_cards=Mustache.to_html(b,{cards:c}),$("#imageCards").html(rendered_cards)}function init(){$.material.init(),$("#datefilterstart").datetimepicker({format:"YYYY-MM-DD",defaultDate:"2016-01-01"}),$("#datefilterend").datetimepicker({format:"YYYY-MM-DD",defaultDate:new Date})}function init_map(){map=L.map("map");var a="http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",b='Map data Â© <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',c=new L.TileLayer(a,{minZoom:2,maxZoom:12,attribution:b});map.setView(new L.LatLng(11.5,121.8),6),map.addLayer(c);var d,e;d=$("#map_section").width(),e=$("#map_section").height(),areaSelect=L.areaSelect({width:d-100,height:e-100}),areaSelect.addTo(map),areaSelect.on("change",function(){bounds=areaSelect.getBounds(),executeFilters(bounds)});var f={radius:8,fillColor:"#1c3166",color:"#000",weight:1,opacity:1,fillOpacity:.8};image_markers=L.geoJson(!1,{pointToLayer:function(a,b){return L.circleMarker(b,f)},onEachFeature:function(a,b){var c=new L.popup,d="";d+="<p>Acquisition Date: "+a.properties.acquisition_date+"</p>",d+="<p>Cloud Cover: "+a.properties.cloud_cover+"</p>",d+="<p>Receiving Station: "+a.properties.receiving_station+"</p>",d+="<p>Satellite: "+a.properties.satellite+"</p>",d+="<p>Scene Name: "+a.properties.scene_name+"</p>",d+="<p>Sensor: "+a.properties.sensor+"</p>",c.setContent(d),b.bindPopup(c)}}),image_markers.addTo(map)}var main_url="http://diwataapi-lkpanganiban.rhcloud.com/api/scene/multi/",img_url="http://diwataapi-lkpanganiban.rhcloud.com/static";$(function(){init(),init_map(),$("#satelliteFilter, #sensorFilter").on("change",function(){executeFilters()}),$("#datefilterstart, #datefilterend").on("dp.change",function(){executeFilters()}),executeFilters()});